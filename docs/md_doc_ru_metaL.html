<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.13"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>metaL/py: ru/ metaL: [meta]programming [L]anguage</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectlogo"><img alt="Logo" src="logo.png"/></td>
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">metaL/py
   </div>
   <div id="projectbrief">Repl.it Programming Language Jam</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.13 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
</script>
<div id="main-nav"></div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

</div><!-- top -->
<div class="header">
  <div class="headertitle">
<div class="title">ru/ <a class="el" href="namespacemetaL.html">metaL</a>: [meta]programming [L]anguage </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p>см. также <a href="modules.html">модули документации</a> и <a href="index.html">главную страницу</a> (<a class="el" href="README_8md.html">README.md</a>)</p>
<hr/>
<p>Язык (мета)программирования <code><a class="el" href="namespacemetaL.html">metaL</a></code> был разработан как смесь Lisp и Python, но с точки зрения не синтаксиса, а духа этих языков.</p>
<ul>
<li><em>Python</em> прост в использовании и имеет очень удобный синтаксис</li>
<li><em>Lisp</em> обладает волшебством самомодификации, способной изменять программу во время выполнения, и работать с программой как со структурой данных</li>
<li><em><a class="el" href="namespaceSmalltalk.html">Smalltalk</a></em> это чистый ООП-язык, работающий на основе передачей сообщений, которая идеально подходит для распределенных и параллельных систем.</li>
</ul>
<p>Цель и идеология <code><a class="el" href="namespacemetaL.html">metaL</a></code> не в написание прикладных программ, а <b>создание программ, которые генерируют исходный код других программы</b> (генерация Си-кода, который может быть скомпилирован и запущен на любой компьютерной системе).</p>
<p>Не пытайтесь написать что-то, что должно быть быстрым, типа числодробилки или игрового движка &ndash; <code><a class="el" href="namespacemetaL.html">metaL</a></code> просто так не работает, и быстрое выполнение не предполагалось. Он был создан для манипуляций с программными структурами, и вы можете писать очень быстрые программы в <code><a class="el" href="namespacemetaL.html">metaL</a></code>, если вы используете его правильно: для генерации исходного кода вашего приложения.</p>
<hr/>
<h3>Запуск системы</h3>
<ul>
<li>online-версия: <a href="https://repl.it/@metaLmasters/metaL">https://repl.it/@metaLmasters/metaL</a><br />
после входа на сайт repl.it дождитесь завершения инициализации песочницы, кликните мышью в командной консоли, и введите команду запуска: <div class="fragment"><div class="line">Python 3.8.2 (default, Feb 26 2020, 02:56:10)</div><div class="line">&gt; make install</div><div class="line">&gt; bin/python3 -i metaL.py</div><div class="line"></div><div class="line">&lt;vm:metaL&gt; _</div></div><!-- fragment --></li>
<li>локальная установка на собственный компьютер <div class="fragment"><div class="line">~$ git clone -o gh https://github.com/ponyatov/metaL</div><div class="line">~$ cd metaL ; make install</div></div><!-- fragment --></li>
<li>интерактивный режим с автоматическим запуском <a class="el" href="group__repl.html#gaa68c3f209a9f835f178bd690f7636edc">REPL()</a> <div class="fragment"><div class="line">~/metaL$ make metaL/repl</div></div><!-- fragment --></li>
<li>только в Python-режиме: нажмите [Ctrl]+[C] для выхода в интерактивную консоль Python <div class="fragment"><div class="line">~/meta$ bin/python3 -i metaL.py</div><div class="line"></div><div class="line">&lt;vm:metaL&gt; ^C</div><div class="line">Traceback (most recent call last):</div><div class="line">  File &quot;metaL.py&quot;, line 1472, in &lt;module&gt;</div><div class="line">    REPL()</div><div class="line">  File &quot;metaL.py&quot;, line 1454, in REPL</div><div class="line">    command = input(vm.head(test=True) + &#39; &#39;)</div><div class="line">KeyboardInterrupt</div><div class="line">&gt;&gt;&gt; _</div></div><!-- fragment --></li>
<li>самый правильный способ: Python-only с отдельным рабочим файлом и REPL:<br />
 текст редактируется в файле, по [Shift]+[Enter] выделенные куски или строки отсылаются в интерактивную консоль Python, по [F12] система перезапускется с автосохранением проверенного кода<br />
 комментарии с двойными <code>##</code> и <code>@</code>-префиксами относятся к разметке <a href="https://en.wikipedia.org/wiki/Doxygen">DoxyGen</a>, которая используется для подготовки этого руководства</li>
</ul>
<div class="fragment"><div class="line">~/metaL$ code hello.py</div><div class="line">~/metaL$ make hello/repl</div></div><!-- fragment --> <div class="fragment"><div class="line"><span class="comment"># file</span></div><div class="line"><span class="comment"># brief Hello World</span></div><div class="line"></div><div class="line"><span class="keyword">from</span> metaL <span class="keyword">import</span> *</div><div class="line"></div><div class="line">MODULE = Module(<span class="stringliteral">&#39;hello&#39;</span>)</div><div class="line">print(MODULE)</div><div class="line"><span class="comment"># &lt;module:hello&gt; #a04475a2 @7f226970f630</span></div></div><!-- fragment --><hr/>
<p>Для работы online достаточно зайти в песочницу на <a href="https://repl.it/@metaLmasters/metaL">https://repl.it/@metaLmasters/metaL</a> </p><div class="fragment"><div class="line">Python 3.8.2 (default, Feb 26 2020, 02:56:10)</div><div class="line">&gt; pwd</div><div class="line">/home/runner/metaL</div></div><!-- fragment --> <div class="fragment"><div class="line">&gt; make install</div><div class="line">&gt; bin/python3 -i metaL.py</div><div class="line"></div><div class="line">&lt;vm:metaL&gt; #10e7d970 @7f38abc26070</div><div class="line">    ABOUT = &lt;string:homoiconic metaprogramming system\n* powered by `metaL`&gt; #0dfa5b4e @7f38abc26580</div><div class="line">    vm = &lt;vm:metaL&gt; #10e7d970 @7f38abc26070 _/</div><div class="line"></div><div class="line">&lt;vm:metaL&gt; _</div></div><!-- fragment --><p><code><a class="el" href="namespacemetaL.html">metaL</a></code> на самом деле это <b>два</b> языка:</p><ul>
<li><code><a class="el" href="namespacemetaL.html">metaL</a></code>-скрипт со своим синтаксисом, опционален, и находится в зайчаточном состоянии (использовать не будем)<ul>
<li><b>используется только однострочный синтаксис</b> для каждой команды (ограничение функции <code>input()</code> в Python)</li>
<li>выполняется как строка в Python-режиме через функцию <a class="el" href="group__repl.html#gadca7f71af965e163dd4eb02731ea6043">metaL()</a></li>
<li>выполняется интерактивно после запуска <a class="el" href="group__repl.html#gaa68c3f209a9f835f178bd690f7636edc">REPL()</a></li>
</ul>
</li>
<li><code><a class="el" href="namespacemetaL.html">metaL</a></code> как он изначально задумывался: no-syntax <b>язык определённый на данных</b> (в виде <em>самоинтерпретируемых структур данных</em> реализованных на Python)</li>
</ul>
<p><code><a class="el" href="namespacemetaL.html">metaL</a></code> задумывался как модуль расширения Python, который использует рантайм CPython3, интерпретатор и синтаксис Python включая REPL, и <b>объектный граф</b> как универсальную структуру для представления одновременно и программ и данных. Python как язык очень прост в освоении, но крайне ограничен, и неприменим в чистом виде для некоторых приложений (микроконтроллеры, используемые в приложениях IoT, системы жёсткого реального времени, компактные приложения и <code>unikernel</code> микроОС для виртуальных сред).</p>
<p>Предполагается, что <code><a class="el" href="namespacemetaL.html">metaL</a></code></p><ul>
<li>может быть реализован как <em>гостевой язык данных</em> на любом удобном для программиста <b>хост-языке</b> (предпочтительны динамические с REPL: Python, Lisp/Clojure, PHP), в виде <a href="https://ru.wikipedia.org/wiki/%D0%93%D0%BE%D0%BC%D0%BE%D0%B8%D0%BA%D0%BE%D0%BD%D0%B8%D1%87%D0%BD%D0%BE%D1%81%D1%82%D1%8C">гомоиконичного</a> <em>интерпретатора структур данных</em></li>
<li>специальный синтаксис не используется, для работы с <code><a class="el" href="namespacemetaL.html">metaL</a></code> применяется REPL и синтаксис хост-языка, особенно для написания различных <b>трансформаций</b> и методов, по крайней мере пока <code><a class="el" href="namespacemetaL.html">metaL</a></code> не станет достаточно зрелым чтобы быть переписанным на самом себе</li>
<li>основной и единственный метод: <em>гетерогенное генеративное</em> <b>мета-программирование</b><ul>
<li>на <code><a class="el" href="namespacemetaL.html">metaL</a></code> <b>описываются модели</b> проектируемых приложений, программно-аппаратаных систем, <em>модели предметной области</em>, методы преобразования моделей</li>
<li>полученные прикладные модели транслируются в компилируемые модели (AST, атрибутные грамматики) <b>целевого языка программирования</b></li>
<li><em>компилируемые модели</em> транслируются в произвольно выбранный 1+ целевой язык, с которым работает команда разработчиков</li>
<li>полученный исходный код компилируется <em>backend-компилятором</em> (gcc, javac,..) и интегрируется с любыми существующими системами и инструментами</li>
<li>за счёт разделения host-языка разработки и моделирования (используется только в design time), и target-языка реализации (compile/runtime), избавляемся от блокировок по инструментарию, и необходимости заставлять всю команду учить и поддерживать еще один птичий язык</li>
</ul>
</li>
<li>главная задача <code><a class="el" href="namespacemetaL.html">metaL</a></code>: <b>создание неограниченно-расширяемой языковой среды</b> для проектирования и моделирования, в которой разработчик может самостоятельно реализовать и применять любые подходы и методы программирования, не ограничиваясь возможностями хост-языка, и не имея жёсткой привязки к целевому стеку (язык, runtime, библиотеки, фреймворки, ОС, СУБД, схема развёртывания, и т.д.).</li>
<li>для проектов использующих динамические хост-языки, возможно использование <code><a class="el" href="namespacemetaL.html">metaL</a></code> в рантайме в <b>режиме симуляции</b>, но такое использование допускается только для прототипирования, сбора статистики, оптимизации и отладки. Никаких средств контроля типов, управления доступом к памяти и ресурсам в <code><a class="el" href="namespacemetaL.html">metaL</a></code> не планируется, поэтому при взломе приложения работающего в режиме симуляции атакующий получает полный неограниченный доступ. В случае ошибок поведение системы непредсказуемо, и возможны любые повреждения данных. Целевая компиляция моделей добавляет средства контроля кода, доступные для backend-компилятора (как минимум проверку типов), и код безопасности предусмотренный разработчиком и авторами <code><a class="el" href="namespacemetaL.html">metaL</a></code>-библиотек.</li>
</ul>
<div class="image">
<object type="image/svg+xml" data="hosttarget.svg">hosttarget.svg</object>
</div>
<ul>
<li><em>значительное преимущество</em> применения <code><a class="el" href="namespacemetaL.html">metaL</a></code> перед обычным ручным программированием &ndash; возможность строить гетерогенные распределенные системы, состоящие из разнородных компонентов (backend, RDBMS, MQ, frontend, хранилища,..), <b>с обеспечением консистентности логики и данных между разными частями системы</b>. Особенно важно для систем,<ul>
<li>реализованных на разных языковых стеках,</li>
<li>выполняющих множество разнотипных задач,</li>
<li>при часто меняющихся в процессе эксплуатации требованиях (по велению левой пятки, сделать вчера),</li>
<li>с большим объёмом legacy (PHP5, Delphi)</li>
<li>работа с данными в специализированных desktop приложениях.</li>
<li>распределённые системы сбора/обработки данных (телеметрия, мониторинг, измерительные сети, АСУ ТП, IIoT,..)</li>
</ul>
</li>
</ul>
<hr/>
<div class="image">
<object type="image/svg+xml" data="tutorial.svg">tutorial.svg</object>
</div>
<h3>REPL: Read-Eval-Print-Loop</h3>
<p><em>Цикл чтение-вычисление-печать</em> и интерактивный режим Python, сочетаемый с посылкой кусков <code>.py</code> кода из редактора &ndash; важный способ работы с <code><a class="el" href="namespacemetaL.html">metaL</a></code>.</p>
<p>Сначала вы отлаживаете код интерактивно, выполняя код пошагово, и наблюдая результат его выполнения, а затем перезапускаете Python c автосохранением рабочего файла со всеми сделанными изменениями. В результате у вас есть одновременно и интерактивность, и резервная копия в системе контроля версий. В идеале конечно была бы графическая система в стиле <a class="el" href="namespaceSmalltalk.html">Smalltalk</a> с графикой, персистентной памятью хранящей полное состояние системы при перезапусках, и интерактивный отладчик, но реализовать такую систему на порядки сложнее, чем использовать уже готовые встроенные возможности IDE (VSCode).</p>
<h3>Hello World</h3>
<div class="fragment"><div class="line">~/metaL$ code hello.py</div><div class="line">~/metaL$ make hello/repl</div></div><!-- fragment --><div class="fragment"><div class="line">MODULE = Module(<span class="stringliteral">&#39;hello&#39;</span>)</div><div class="line">print(MODULE)</div><div class="line"><span class="comment"># &lt;module:hello&gt; #a04475a2 @7f28c441a710</span></div></div><!-- fragment --><p>Модуль &ndash; объект-контейнер, объединяющий другие объекты, относящиеся к одному <code>.py</code>-файлу (модулю), единице компиляции (C++) или даже большому проекту.</p>
<p>Базовый Module не умеет ничего, и работает только как универсальный контейнер. Наследованные от него классы модулей включают генерацию целевого кода, создание файлов и каталогов, вплоть до генерации достаточно сложных объектных графов с моделями типовых проектов Django и полноразмерных бизнес-сервисов. </p><div class="fragment"><div class="line"><span class="keyword">class </span>djModule(pyModule):</div><div class="line">    <span class="keyword">def </span>__init__(self, V=None):</div><div class="line">        pyModule.__init__(self, V)</div><div class="line">        reqs = self.diroot[<span class="stringliteral">&#39;reqs&#39;</span>]</div><div class="line">        reqs // <span class="stringliteral">&#39;django&#39;</span></div><div class="line">        reqs.sync()</div><div class="line"></div><div class="line">MODULE = djModule(<span class="stringliteral">&#39;bully&#39;</span>)</div></div><!-- fragment --> <div class="fragment"><div class="line">~/metaL$ find bully</div><div class="line"></div><div class="line">bully/README.md</div><div class="line">bully/Makefile</div><div class="line">bully/bully.py</div><div class="line">bully/config.py</div><div class="line">bully/requirements.txt</div><div class="line">bully/.vscode/settings.json</div><div class="line">bully/.gitignore</div><div class="line">bully/apt.txt</div></div><!-- fragment --><h3><code>anyModule</code></h3>
<p>В качестве примера можно разобрать часть кода <code>anyModule</code></p>
<div class="fragment"><div class="line"><span class="keyword">class </span>anyModule(Module):</div><div class="line">    <span class="keyword">def </span>__init__(self, V):</div><div class="line">        <span class="comment"># сначала вызываем супер-класс, от которого наследуем свой тип проекта</span></div><div class="line">        Module.__init__(self, V)</div><div class="line">        <span class="comment"># заполняем метаинформацию модуля</span></div><div class="line">        <span class="comment"># часть данных можно наследовать из другого объекта (глобальной виртуальной машины metaL)</span></div><div class="line">        self &lt;&lt; vm[<span class="stringliteral">&#39;AUTHOR&#39;</span>]</div><div class="line">        self &lt;&lt; vm[<span class="stringliteral">&#39;EMAIL&#39;</span>]</div><div class="line">        self[<span class="stringliteral">&#39;year&#39;</span>] = vm[<span class="stringliteral">&#39;YEAR&#39;</span>]</div><div class="line">        self &lt;&lt; vm[<span class="stringliteral">&#39;LICENSE&#39;</span>]</div></div><!-- fragment --> <div class="fragment"><div class="line">hello = anyModule(<span class="stringliteral">&#39;hello&#39;</span>)</div><div class="line">print(hello)</div></div><!-- fragment --><p> Здесь мы видим несколько странных операторов, и еще более странный вывод объектного графа: </p><div class="fragment"><div class="line">&lt;anymodule:hello&gt; #3d2f9e06 @7f4def8c2748</div><div class="line">        author = &lt;author:Dmitry Ponyatov&gt; #f9ea65c5 @7f4df0005860</div><div class="line">                email = &lt;email:dponyatov@gmail.com&gt; #5c493931 @7f4df0005828</div><div class="line">        email = &lt;email:dponyatov@gmail.com&gt; #5c493931 @7f4df0005828 _/</div><div class="line">        license = &lt;license:MIT&gt; #b2969ad0 @7f4df0005908</div><div class="line">        year = &lt;integer:2020&gt; #04567cb9 @7f4df00058d0</div></div><!-- fragment --><h2><code>Object</code></h2>
<div class="fragment"><div class="line"><span class="comment"># базовый класс узла объектного графа</span></div><div class="line"><span class="keyword">class </span>Object:</div><div class="line">    <span class="comment"># конструктор создает узел с заданным скалярным значением</span></div><div class="line">    <span class="keyword">def </span>__init__(self, V):</div><div class="line">        <span class="comment"># имя символа, узла, скалярное значение (строка, число,..)</span></div><div class="line">        self.val = V</div><div class="line">        <span class="comment"># слоты = атрибуты = словарь {строка:ограф}</span></div><div class="line">        self.slot = {}</div><div class="line">        <span class="comment"># упорядоченные вложенные графы = AST = вектор = стек = очередь</span></div><div class="line">        self.nest = []</div></div><!-- fragment --><p> Базовый класс узла свободно наследуется, определяя конкретные типы данных, исполняемые/компилируемые элементы программ, и компоненты моделей. Часть типов узлов задана в языке <code><a class="el" href="namespacemetaL.html">metaL</a></code> как предопределенные, от них вы можете наследовать свои собственные типы. Возможность множественного наследования зависит от хост-языка (в Python есть), но для переносимости желательно от него избавится.</p>
<div class="image">
<object type="image/svg+xml" data="taxonomy.svg">taxonomy.svg</object>
</div>
<h3>Операторы</h3>
<p>Также для базового Object задано несколько операторов, позволяющих адресовать части графа: слоты по строковым ключам, вложенные элементы по целым числам, добавлять вложенные подграфы в стек, удалять слоты по имени и т.п.</p><ul>
<li><code>A.keys()</code> <br />
 список ключей слотов</li>
<li><code>A[key] ~&gt; A.slot[key:str] | A.nest[key:int]</code></li>
<li><code>A[key] = B</code> <br />
 создание/изменение слота по имени <code>key</code> (Python-строка)</li>
<li><code>A &lt;&lt; B ~&gt; A[B.type] = B</code> <br />
 присвоение слота с именем типа операнда (по левому полю <code>&lt;&lt;T:V&gt;</code>)</li>
<li><code>A &gt;&gt; B ~&gt; A[B.val] = B</code> <br />
 присвоение слота со значением <code>.val</code> операнда (по правому полю <code>&lt;T:V&gt;&gt;</code>)</li>
<li><code>A // B -&gt; A.push(B)</code> <br />
 запихнуть операнд как в стек (последним)</li>
<li>...</li>
</ul>
<p>Для числовых типов также определены арифметические операторы, через соответствующие методы класса.</p>
<p>Сами операторы также определены как класс <code>Op</code>, т.е. вы можете конструировать арифметические выражения в виде дерева, и после запуска дерева на выполнение (вычисление), каждый объеет-оператор знает как себя вычислить (рекурсивно).</p>
<h3>Дамп</h3>
<p>Наконец, для интерактивной работы с графами и просмотра их состояния необходим какой-то способ их отображения. Для интерактивной консоли как минимум нужен текстовый формат. Также можно реализовать графический вывод. Для текстового формата естественным является отображение в виде дерева: количество табуляций в каждой строке задает глубину от начального узла, с которого начинается обход графа.</p>
<p>Для каждого узла выводится заголовок в форме <code>&lt;T:V&gt;</code>, в который также входят</p><ul>
<li>хеш-сумма, вычисляющаяся по данным и хэшам вложенных графов, и</li>
<li>указатель в памяти (позволяет отличить два объекта с одинаковым значением)</li>
</ul>
<p>Далее идут слоты в форме <code>&lt;ключ&gt; = &lt;граф (поддерево)&gt;</code> и вложенные элементы с числовым индексом.</p>
<p>Объектные графы являются циклической структурой, т.е. в любом графе в качестве вложенного элемента может оказаться он сам. Для таких случаев при выводе дампа ведется список уже выведенных объектов, и их повторения выводятся только заголовком с суффиксом <code>_/</code>: </p><div class="fragment"><div class="line">&lt;vm:metaL&gt; #10e7d970 @7f24f91b1278</div><div class="line">        module = &lt;class:Module&gt; #e4c6b3b6 @7f24f91b1390</div><div class="line">        vm = &lt;vm:metaL&gt; #10e7d970 @7f24f91b1278 _/</div></div><!-- fragment --><h3><code>anyModule</code> продолжение</h3>
<div class="fragment"><div class="line"><span class="keyword">class </span>anyModule(Module):</div><div class="line">    <span class="keyword">def </span>__init__(self, V):</div><div class="line">        ...</div><div class="line">        <span class="comment"># diroot: корневой каталог проекта</span></div><div class="line">        self.diroot = Dir(V) <span class="comment"># создаем как поле Python-объекта</span></div><div class="line">        self &lt;&lt; self.diroot  <span class="comment"># также регистрируем как поле self.[`dir`]</span></div><div class="line"></div><div class="line"><span class="comment"># &lt;anymodule:hello&gt; #eca3654b @7f05e12e1748</span></div><div class="line"><span class="comment">#     dir = &lt;dir:hello&gt; #9338a3f6 @7f05e12e1898</span></div></div><!-- fragment --><p>Теперь при создании любого экземпляра `anyModule('hello')<code>или его наследника в текущем каталоге будет создаваться каталог</code>~/metaL/hello`. </p>
</div></div><!-- contents -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated by &#160;<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/>
</a> 1.8.13
</small></address>
</body>
</html>
