<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.13"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>metaL/py: SICP 1.1.1 Expressions</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectlogo"><img alt="Logo" src="logo.png"/></td>
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">metaL/py
   </div>
   <div id="projectbrief">Repl.it Programming Language Jam</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.13 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
</script>
<div id="main-nav"></div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

</div><!-- top -->
<div class="header">
  <div class="headertitle">
<div class="title">SICP 1.1.1 Expressions </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p><a href="https://xuanji.appspot.com/isicp/1-1-elements.html">https://xuanji.appspot.com/isicp/1-1-elements.html</a></p>
<p>Numerical constant in Lisp/Scheme</p>
<div class="fragment"><div class="line">lisp&gt; 486</div><div class="line">486</div></div><!-- fragment --><p>is equal to <code><a class="el" href="namespacemetaL.html">metaL</a></code> object in Python:</p>
<div class="fragment"><div class="line">&gt;&gt;&gt; Integer(486)</div><div class="line"></div><div class="line">&lt;integer:486&gt; @7fd3b22280f0</div></div><!-- fragment --><p>and also in <code><a class="el" href="namespacemetaL.html">metaL</a></code> CLI shell:</p>
<div class="fragment"><div class="line">metaL&gt; 486</div><div class="line"></div><div class="line"># AST parsed from DML/DDL line</div><div class="line">&lt;integer:486&gt; @7f0f7c52a358</div><div class="line"></div><div class="line"># evaluated AST</div><div class="line">&lt;integer:486&gt; @7f0f7c52a358</div><div class="line">------------------------------------------------------------------</div></div><!-- fragment --><p>Differences of <code><a class="el" href="namespacemetaL.html">metaL</a></code> language model from generic Lisp/Scheme described in the [SICP] book:</p><ul>
<li>lists are totally replaced by object graphs, every element is typed, which is closer to <a href="http://wambook.sourceforge.net/">Prolog predicate structures</a> then Lisp lists/trees</li>
<li>there are no atoms &ndash; every <code>Primitive</code> object can have arbitrary attributes and even nested subelements (such as units or tolerance data)</li>
<li>there is a special case of <code>Op</code>erators which has a fixed number of operands and can't be applied such a <code>+</code> function here:</li>
</ul>
<h3><code>(+ 137 349)</code></h3>
<div class="fragment"><div class="line">&gt; (+ 137 349)</div><div class="line">486</div></div><!-- fragment --> <div class="fragment"><div class="line">&gt;&gt;&gt; ast = Op(<span class="stringliteral">&#39;+&#39;</span>) // Integer(137) // Integer(349)</div><div class="line">&gt;&gt;&gt; ast</div><div class="line"></div><div class="line">&lt;op:+&gt; @7f0f8aad2208</div><div class="line">        0: &lt;integer:137&gt; @7f0f8aad2240</div><div class="line">        1: &lt;integer:349&gt; @7f0f8aad2828</div><div class="line"></div><div class="line">&gt;&gt;&gt; ast.eval(vm)</div><div class="line"></div><div class="line">&lt;integer:486&gt; @7fd06e7c7828</div></div><!-- fragment --> <div class="fragment"><div class="line">metaL&gt; 137+439</div><div class="line"></div><div class="line">&lt;op:+&gt; @7f0b0065c6a0</div><div class="line">        0: &lt;integer:137&gt; @7f0b0065c588</div><div class="line">        1: &lt;integer:439&gt; @7f0b0065c8d0</div><div class="line"></div><div class="line">&lt;integer:576&gt; @7f0b0065c1d0</div><div class="line">------------------------------------------------------------------</div></div><!-- fragment --><h3><code>(- 1000 334)</code></h3>
<div class="fragment"><div class="line">&gt; (- 1000 334)</div><div class="line">666</div></div><!-- fragment --> <div class="fragment"><div class="line">&gt;&gt;&gt; ast = Op(<span class="stringliteral">&#39;-&#39;</span>) // Integer(1000) // Integer(334)</div><div class="line">&gt;&gt;&gt; ast</div><div class="line"></div><div class="line">&lt;op:-&gt; @7f535f2c91d0</div><div class="line">        0: &lt;integer:1000&gt; @7f535f2c9208</div><div class="line">        1: &lt;integer:334&gt; @7f535f2c9240</div><div class="line"></div><div class="line">&gt;&gt;&gt; ast.eval(vm)</div><div class="line"></div><div class="line">&lt;integer:666&gt; @7f535f2c9278</div></div><!-- fragment --> <div class="fragment"><div class="line">metaL&gt; 1000 -334</div><div class="line"></div><div class="line">&lt;op:-&gt; @7fe5164426a0</div><div class="line">        0: &lt;integer:1000&gt; @7fe516442898</div><div class="line">        1: &lt;integer:334&gt; @7fe5164428d0</div><div class="line"></div><div class="line">&lt;integer:666&gt; @7fe5164421d0</div><div class="line">------------------------------------------------------------------</div></div><!-- fragment --><h3><code>(* 5 99)</code></h3>
<div class="fragment"><div class="line">&gt; (* 5 99)</div><div class="line">495</div></div><!-- fragment --> <div class="fragment"><div class="line">&gt;&gt;&gt; parser.parse(<span class="stringliteral">&#39;5*99&#39;</span>)</div><div class="line"></div><div class="line">&lt;ast:&gt; @7fca95730320</div><div class="line">        0: &lt;op:*&gt; @7fca95730a58</div><div class="line">                0: &lt;integer:5&gt; @7fca957302e8</div><div class="line">                1: &lt;integer:99&gt; @7fca95ab5080</div><div class="line"></div><div class="line">&gt;&gt;&gt; parser.parse(<span class="stringliteral">&#39;5*99&#39;</span>)[0].eval(vm)</div><div class="line"></div><div class="line">&lt;integer:495&gt; @7fca95ab50f0</div></div><!-- fragment --><p>The computation process is going from the parsed AST tree via:</p><ul>
<li>source code string passed to <code>parser.parse(source)</code></li>
<li>the <a href="https://www.dabeaz.com/ply/ply.html">PLY library</a> provides a simple way for defining custom syntax<ul>
<li><a href="https://riptutorial.com/python/example/31583/the&ndash;hello&ndash;world&mdash;of-ply&mdash;a-simple-calculator">https://riptutorial.com/python/example/31583/the&amp;ndash;hello&amp;ndash;world&amp;mdash;of-ply&amp;mdash;a-simple-calculator</a></li>
<li>parser is an optional part of the <code><a class="el" href="namespacemetaL.html">metaL</a></code>, and you are also free to make a syntax you want</li>
<li>if you want, you can define structures directly in Python using object graph constructors and special operators such as <code>//</code>, <code>&lt;&lt;</code>, <code>&gt;&gt;</code>, <code>object[key]</code>, and <code>object[key]=other</code></li>
</ul>
</li>
<li>most complex structures can't be defined via a parser, so there only two ways leaves:<ul>
<li>define structure procedurally in Python</li>
<li>use <em>structure self-modification</em>, when more simple parsed <b>structures must be executed by calling its self-interpreting methods</b><ul>
<li>mostly <code>.eval()</code> and <code>.<a class="el" href="namespacedistill.html#a594e49362e0e6e91684cde9efe64e980" title=".apply() method template ">apply()</a></code></li>
<li>but also they have some operator and transformations methods</li>
<li>also, <b>you can define your own arbitrary transformation methods</b> for custom cases in the <em>host language</em> (Python) &ndash; that's how <code><a class="el" href="namespacemetaL.html">metaL</a></code> powers</li>
<li>while structure interprets itself, it can modify the context in which it is executing &ndash; this is not pure functional but is practical in real</li>
</ul>
</li>
</ul>
</li>
</ul>
<h3><code>(/ 10 5)</code></h3>
<div class="fragment"><div class="line">&gt; (/ 10 5)</div><div class="line">2</div></div><!-- fragment --> <div class="fragment"><div class="line">&gt;&gt;&gt; parser.parse(<span class="stringliteral">&#39;10/5&#39;</span>)[0].eval(vm)</div><div class="line"></div><div class="line">&lt;integer:2&gt; @7f63ddb192b0</div></div><!-- fragment --><h3><code>(+ 2.7 10)</code></h3>
<div class="fragment"><div class="line">&gt; (+ 2.7 10)</div><div class="line">12.7</div></div><!-- fragment --> <div class="fragment"><div class="line">&gt;&gt;&gt; ast = Op(<span class="stringliteral">&#39;+&#39;</span>) // Number(2.7) // Integer(10)</div><div class="line"></div><div class="line">&lt;op:+&gt; @7f79ea4971d0</div><div class="line">        0: &lt;number:2.7&gt; @7f79ea497208</div><div class="line">        1: &lt;integer:10&gt; @7f79ea497240</div><div class="line"></div><div class="line">&gt;&gt;&gt; ast.eval(vm)</div><div class="line">Traceback (most recent call last):</div><div class="line">  File <span class="stringliteral">&quot;&lt;stdin&gt;&quot;</span>, line 1, <span class="keywordflow">in</span> &lt;module&gt;</div><div class="line">  File <span class="stringliteral">&quot;metaL.py&quot;</span>, line 278, <span class="keywordflow">in</span> eval</div><div class="line">    <span class="keywordflow">return</span> greedy[0].add(greedy[1], ctx)</div><div class="line">  File <span class="stringliteral">&quot;metaL.py&quot;</span>, line 183, <span class="keywordflow">in</span> add</div><div class="line">    <span class="keyword">assert</span> type(that) == self.__class__</div><div class="line">AssertionError</div></div><!-- fragment --><p>In Lisp, we have <em>implicit/automatic type conversion</em>, so this mixed-typed expression can be evaluated as is.</p>
<p>In <code><a class="el" href="namespacemetaL.html">metaL</a></code> more rigid type checking were used to get fewer errors, and force programmers to use an <em>explicit type cast</em> only in places where it is required. As a result, any mixed-typed expression can be defined but will be evaluated with an error exception.</p>
<p>Rigid typing is controversial especially if you mostly use Python which has a lighter type checking.</p>
<h3><code>(+ 21 35 12 7)</code></h3>
<div class="fragment"><div class="line">&gt; (+ 21 35 12 7)</div><div class="line">75</div><div class="line">&gt; (* 25 4 12)</div><div class="line">1200</div></div><!-- fragment --><p>Lisp has unlimited numbers of operands for such functions as <code>+</code>. It can be a bit discouraging that <code><a class="el" href="namespacemetaL.html">metaL</a></code> operators has fixed number of operands. While I still have no cases where it was required to support, it leaves that way, but you can modify operator transformations to provide more compatible computation (maybe you are porting some old Lisp software).</p>
<h3><code>(+ (* 3 5) (- 10 6))</code></h3>
<div class="fragment"><div class="line">&gt; (+ (* 3 5) (- 10 6))</div><div class="line">19</div></div><!-- fragment --> <div class="fragment"><div class="line">&gt;&gt;&gt; ast = parser.parse(<span class="stringliteral">&#39;(+ (* 3 5) (- 10 6))&#39;</span>)[0]</div></div><!-- fragment --> </div></div><!-- contents -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated by &#160;<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/>
</a> 1.8.13
</small></address>
</body>
</html>
